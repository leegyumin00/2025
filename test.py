import streamlit as st

# --- 1. 앱 기본 설정 ---
st.set_page_config(
    page_title="학년별 추천 도서 & 독후감 공유 플랫폼",
    page_icon="📚",
    layout="wide"
)

st.title("📚 학년별 추천 도서 & 독후감 공유 플랫폼")
st.write("📖 우리 함께 좋은 책을 읽고 생각을 나눠봐요!")

# --- 2. 독후감 저장을 위한 세션 상태 초기화 ---
# 앱이 다시 실행되거나 새로고침 될 때마다 초기화되지 않도록 st.session_state를 사용해요.
if 'reviews' not in st.session_state:
    st.session_state.reviews = []

# --- 3. 학년별 추천 도서 데이터 ---
# 여기에 더 많은 학년과 책 정보를 추가할 수 있어요.
recommended_books = {
    "1학년": [
        {"제목": "강아지 똥", "저자": "권정생", "설명": "작고 보잘것없는 강아지 똥이 민들레를 피워내는 감동적인 이야기입니다. 생명의 소중함과 보잘것없어 보이는 존재의 가치를 깨닫게 해 줍니다."},
        {"제목": "사자와 마법 옷장", "저자": "C.S. 루이스", "설명": "나니아 연대기의 시작을 알리는 판타지 소설로, 아이들이 상상의 세계에 푹 빠지게 합니다."},
        {"제목": "눈사람 아저씨", "저자": "레이먼드 브릭스", "설명": "크리스마스 이브에 살아 움직이는 눈사람과 소년의 우정을 아름다운 그림으로 담아낸 따뜻한 이야기입니다."},
    ],
    "2학년": [
        {"제목": "모모", "저자": "미하엘 엔데", "설명": "시간 도둑들에게 빼앗긴 시간을 찾아주는 특별한 능력을 가진 소녀 모모의 이야기입니다. 시간의 진정한 가치를 생각하게 합니다."},
        {"제목": "로빈슨 크루소", "저자": "다니엘 디포", "설명": "무인도에 표류하게 된 로빈슨 크루소의 생존과 모험을 다룬 이야기입니다. 개척 정신과 용기를 배울 수 있습니다."},
        {"제목": "우리 아빠가 최고야", "저자": "앤서니 브라운", "설명": "아빠가 얼마나 멋지고 대단한 존재인지를 아이의 시선으로 유쾌하게 표현한 그림책입니다. 아빠와 아이의 관계를 따뜻하게 그려냈습니다."},
    ],
    "3학년": [
        {"제목": "샬롯의 거미줄", "저자": "E.B. 화이트", "설명": "농장의 아기 돼지 윌버와 지혜로운 거미 샬롯의 우정과 삶의 아름다움을 다룬 감동적인 이야기입니다."},
        {"제목": "나는 고양이로소이다", "저자": "나쓰메 소세키", "설명": "고양이의 시선으로 인간 사회의 위선과 부조리를 풍자하는 소설입니다. 재치 있는 문체와 풍부한 해학이 돋보입니다."},
        {"제목": "연어", "저자": "안도현", "설명": "강물을 거슬러 오르는 연어들의 숭고한 삶과 사랑을 통해 삶의 의미와 깨달음을 전하는 소설입니다. 순수하고 아름다운 문장이 인상적입니다."},
    ],
    "4학년": [
        {"제목": "어린 왕자", "저자": "앙투안 드 생텍쥐페리", "설명": "작은 별에서 온 어린 왕자와 조종사의 만남을 통해 삶의 본질, 사랑, 우정의 의미를 깊이 있게 탐색하는 철학적인 동화입니다."},
        {"제목": "몽실 언니", "저자": "권정생", "설명": "한국 전쟁의 비극 속에서도 꿋꿋하게 삶을 이어가는 몽실 언니의 이야기를 통해 우리 역사의 아픔과 인간적인 끈끈함을 배울 수 있습니다."},
        {"제목": "만딩고", "저자": "알렉스 헤일리", "설명": "아프리카에서 노예로 끌려온 쿤타 킨테와 그의 후손들의 삶을 통해 노예 제도의 아픔과 자유를 향한 인간의 끊임없는 열망을 다룬 대작입니다."},
    ],
    "5학년": [
        {"제목": "걸리버 여행기", "저자": "조너선 스위프트", "설명": "걸리버가 여러 기이한 나라를 여행하며 겪는 모험을 통해 당시 사회를 날카롭게 비판하는 풍자 소설입니다."},
        {"제목": "주홍 글씨", "저자": "너새니얼 호손", "설명": "청교도 사회의 위선과 죄의식, 그리고 한 여성의 용기와 인간적인 고뇌를 깊이 있게 다룬 소설입니다. 인간 내면의 갈등과 사회적 편견을 다룹니다."},
        {"제목": "새의 선물", "저자": "은희경", "설명": "어린 주인공 '나'의 시선을 통해 어른들의 세계를 해학과 비판으로 그려낸 성장 소설입니다. 세상의 부조리와 편견에 대한 질문을 던집니다."},
    ],
    "6학년": [
        {"제목": "톰 소여의 모험", "저자": "마크 트웨인", "설명": "미국 미시시피 강변 마을에서 톰 소여와 허클베리 핀이 벌이는 좌충우돌 모험을 통해 자유와 순수한 어린 시절을 그리는 소설입니다."},
        {"제목": "열하일기", "저자": "박지원", "설명": "박지원이 중국 청나라를 다녀오며 보고 듣고 느낀 것을 기록한 여행기로, 당시 조선 사회에 대한 비판적 시각과 실학 정신이 돋보이는 고전입니다."},
        {"제목": "레 미제라블", "저자": "빅토르 위고", "설명": "혁명기 프랑스를 배경으로 고통받는 민중들의 삶과 휴머니즘을 장대하게 그려낸 대서사시입니다. 인간의 존엄성과 사회 정의에 대한 깊은 질문을 던집니다."},
    ]
}

# --- 4. 추천 도서 섹션 ---
st.header("💡 학년별 추천 도서 둘러보기")
selected_grade = st.selectbox("어떤 학년의 추천 도서를 보고 싶나요?", list(recommended_books.keys()))

st.markdown(f"### {selected_grade} 친구들에게 추천하는 도서예요!")

# 선택된 학년에 해당하는 책들을 표시
for book in recommended_books[selected_grade]:
    with st.expander(f"📚 {book['제목']} - {book['저자']}"):
        st.write(f"**📖 작가:** {book['저자']}")
        st.write(f"**📝 내용:** {book['설명']}")
        st.write("---") # 구분을 위한 선

# --- 5. 독후감 작성 섹션 ---
st.header("✍️ 나만의 독후감 작성하기")
st.write("읽은 책에 대한 생각을 자유롭게 나누어주세요!")

# st.form을 사용하여 입력 필드를 그룹화하고, 제출 시 한 번에 처리
with st.form("book_review_form", clear_on_submit=True):
    review_book_title = st.text_input("독후감을 쓸 책 제목을 입력하세요:", key="review_title")
    review_author = st.text_input("책의 저자를 입력하세요:", key="review_author")
    review_content = st.text_area("독후감 내용을 작성해주세요:", height=200, key="review_content")
    submitted = st.form_submit_button("독후감 제출하기")

    if submitted:
        if review_book_title and review_author and review_content:
            st.session_state.reviews.append({
                "제목": review_book_title,
                "저자": review_author,
                "내용": review_content,
                "시간": st.sidebar.empty().text(st.time()), # 제출 시간 기록
                "이름": "익명 참여자" # 실제 앱에서는 사용자 이름 등을 추가할 수 있어요.
            })
            st.success("독후감이 성공적으로 제출되었어요! ✨")
        else:
            st.warning("모든 필드를 채워주세요! (책 제목, 저자, 내용)")

# --- 6. 모두의 독후감 섹션 ---
st.header("📢 모두의 독후감")
if st.session_state.reviews:
    # 최신 독후감부터 보이도록 역순 정렬
    for i, review in enumerate(reversed(st.session_state.reviews)):
        st.markdown(f"**✨ {review['제목']}** - {review['저자']}")
        st.write(f"_{review['이름']} (작성 시간: {review['시간']})_") # 작성 시간 출력 추가
        st.info(review['내용'])
        st.write("---")
else:
    st.write("아직 작성된 독후감이 없어요. 첫 독후감을 남겨보세요! 📝")

# --- 앱 하단 (선택 사항) ---
st.sidebar.markdown("---")
st.sidebar.markdown("### 만든 사람")
st.sidebar.write("누나 (초등학교 선생님을 꿈꾸는 예비 개발자!)")
st.sidebar.markdown("---")
st.sidebar.write("이 앱은 Streamlit으로 만들었습니다. 😊")
